# EsportsFan

Technical test: cf [instructions](./INSTRUCTIONS.md).

An e-sports website and newsletter.

Features:
- Send a newsletter with last results and upcoming matches every 7 days (based on Pandascore API)
- Custom newsletter: users can pick one or more games they're interested in.
- Emails are visible in dev in http://localhost:4000/dev/mailbox
- Oban web in dev: http://localhost:4000/dev/oban


## Run the project

Requirements:
- Elixir 1.19 & Erlang 28
- PostgreSQL
- env var `PANDASCORE_API_KEY`: a [PandaScore](https://www.pandascore.co/) token. The free tier is enough.


You can use the _docker-compose.yml_ to start a PostgreSQL instance.
```shell
# To create and start the container
$ docker compose up -d postgres

# start the container if it already exists
$ docker compose start postgres
```


Run `mix setup` to install and setup dependencies once postgres is running. It also setup the DB (creation, migration, seed).  


EsportsFan is a classic phoenix app. You can start it with

```shell
$ PANDASCORE_API_KEY=XXX mix phx.server
```
or this if you want the console

```shell
$ PANDASCORE_API_KEY=XXX iex -S mix phx.server
```

Now you can visit http://localhost:4000 from your browser.


## About the DB

### Seed

```shell
$ mix run priv/repo/seeds.exs
```
This command will seed the DB with 20000 fake users with subscriptions (cf [mix.exs](./mix.exs)).

> [!IMPORTANT]
> The seed script only creates users. It does **not** create Oban jobs responsible for sending newsletters. 
> You will need to do this from iex console. cf [.iex.exs](./.iex.exs)





## Running the tests

`PANDASCORE_API_KEY` is not needed.

```shell
$ mix test
```

It will create and setup a test database called `esports_fan_test` if it doesn't exist.

## Missing parts

No real front-end with Surface UI. It's mostly LiveViews generated by Phoenix generators.

No observability for production besides logs.

